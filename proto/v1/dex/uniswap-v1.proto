syntax = "proto3";

package uniswap.v1;

message Events { repeated Transaction transactions = 1; }

message Transaction {
  bytes hash = 1;
  bytes from = 2;
  optional bytes to = 3;
  uint64 nonce = 5;
  string gas_price = 6; // uint256
  uint64 gas_limit = 7;
  uint64 gas_used = 8;
  string value = 9; // uint256
  repeated Log logs = 10;
}

// https://github.com/Uniswap/v1-contracts/blob/master/contracts/uniswap_exchange.vy
// https://github.com/Uniswap/v1-contracts/blob/master/contracts/uniswap_factory.vy
message Log {
  bytes address = 1;
  uint64 ordinal = 2;
  repeated bytes topics = 3;
  bytes data = 4;

  // Call metadata (only available on chains with DetailLevel: EXTENDED)
  optional Call call = 5;

  oneof log {
    // Exchange
    TokenPurchase token_purchase = 10;
    EthPurchase eth_purchase = 11;
    AddLiquidity add_liquidity = 12;
    RemoveLiquidity remove_liquidity = 13;

    // Factory
    NewExchange new_exchange = 16;
  }
}

// Call metadata (only available on chains with DetailLevel: EXTENDED)
message Call {
  bytes caller = 1;   // Address that made the call
  uint32 index = 2;   // Index of the call within the transaction
  uint32 depth = 3;   // Depth of the call in the call tree (0 = root)
  CallType call_type = 4;
}

enum CallType {
  CALL_TYPE_UNSPECIFIED = 0;
  CALL_TYPE_CALL = 1;
  CALL_TYPE_CALLCODE = 2;
  CALL_TYPE_DELEGATE = 3;
  CALL_TYPE_STATIC = 4;
  CALL_TYPE_CREATE = 5;
}

/// @notice Emitted when ETH is sold for tokens
/// @param buyer The address of the buyer
/// @param eth_sold The amount of ETH sold
/// @param tokens_bought The amount of tokens bought
message TokenPurchase {
  bytes buyer = 1;          // address (indexed)
  string eth_sold = 2;      // uint256 (indexed)
  string tokens_bought = 3; // uint256 (indexed)
}

/// @notice Emitted when tokens are sold for ETH
/// @param buyer The address of the buyer
/// @param tokens_sold The amount of tokens sold
/// @param eth_bought The amount of ETH bought
message EthPurchase {
  bytes buyer = 1;        // address (indexed)
  string tokens_sold = 2; // uint256 (indexed)
  string eth_bought = 3;  // uint256 (indexed)
}

/// @notice Emitted when liquidity is added to the pool
/// @param provider The liquidity provider address
/// @param eth_amount The amount of ETH added
/// @param token_amount The amount of tokens added
message AddLiquidity {
  bytes provider = 1;      // address (indexed)
  string eth_amount = 2;   // uint256 (indexed)
  string token_amount = 3; // uint256 (indexed)
}

/// @notice Emitted when liquidity is removed from the pool
/// @param provider The liquidity provider address
/// @param eth_amount The amount of ETH removed
/// @param token_amount The amount of tokens removed
message RemoveLiquidity {
  bytes provider = 1;      // address (indexed)
  string eth_amount = 2;   // uint256 (indexed)
  string token_amount = 3; // uint256 (indexed)
}

/// @notice Emitted when tokens are transferred
/// @param from The address sending tokens
/// @param to The address receiving tokens
/// @param value The amount of tokens transferred
message Transfer {
  bytes from = 1;   // address (indexed as _from)
  bytes to = 2;     // address (indexed as _to)
  string value = 3; // uint256 (_value)
}

/// @notice Emitted when an approval is made
/// @param owner The address of the token owner
/// @param spender The address of the spender
/// @param value The amount of tokens approved
message Approval {
  bytes owner = 1;   // address (indexed as _owner)
  bytes spender = 2; // address (indexed as _spender)
  string value = 3;  // uint256 (_value)
}

/// @notice Emitted when a new exchange is created
/// @param token The token address
/// @param exchange The exchange address
message NewExchange {
  bytes token = 1;    // address (indexed)
  bytes exchange = 2; // address (indexed)
}

// StorePool - minimal pool storage type
// Primary key: exchange address
message StorePool {
  bytes currency0 = 1; // token address (ETH is the other currency)
  bytes factory = 2;   // factory address that created the exchange
}
